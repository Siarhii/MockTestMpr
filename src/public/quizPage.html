<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mock Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .bg-custom-dark {
            background-color: rgba(17, 24, 39, 0.8);
        }
    </style>
    <script>
        tailwind.config = {
            darkMode: 'class',
        }

    </script>
</head>

<body
    class="bg-gradient-to-r from-blue-100 to-purple-100 dark:from-gray-800 dark:to-gray-900 text-gray-900 dark:text-gray-100 min-h-screen transition-colors duration-300">

    <nav class="bg-custom-dark dark:bg-gray-800 shadow-lg">
        <div class="max-w-6xl mx-auto px-4">
            <div class="flex justify-between">
                <div class="flex space-x-7">
                    <div>
                        <a href="#" class="flex items-center py-4 px-2">
                            <span class="font-semibold text-gray-300 dark:text-gray-100 text-lg">Placement Go</span>
                        </a>
                    </div>
                </div>
                <div class="flex items-center space-x-3">
                    <div class="hidden sm:flex sm:ml-6 space-x-4">
                        <a href="/homepage"
                            class="rounded-md px-3 py-2 text-sm font-medium text-gray-300 hover:bg-gray-700 hover:text-white">Home</a>
                        <a href="/profilepage"
                            class="rounded-md px-3 py-2 text-sm font-medium text-gray-300 hover:bg-gray-700 hover:text-white">Profile</a>
                        <a href="/leaderboardpage"
                            class="rounded-md px-3 py-2 text-sm font-medium text-gray-300 hover:bg-gray-700 hover:text-white">Leaderboards</a>
                        <a href="/aboutpage"
                            class="rounded-md px-3 py-2 text-sm font-medium text-gray-300 hover:bg-gray-700 hover:text-white">About</a>
                        <a href="/helppage"
                            class="rounded-md px-3 py-2 text-sm font-medium text-gray-300 hover:bg-gray-700 hover:text-white">Help</a>

                        <button id="dark-mode-toggle"
                            class="flex items-center rounded-md px-3 py-2 text-sm font-medium text-gray-300 hover:bg-gray-700 hover:text-white">

                            <span id="darkModeText">Dark</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <div class="max-w-3xl mx-auto py-10 px-4">
        <!-- <h1 class="text-4xl font-bold text-center mb-8 text-indigo-800 dark:text-indigo-300">Placement Go Mock Test</h1> -->
        <div id="timer" class="text-2xl font-bold text-center mb-6 text-indigo-600 dark:text-indigo-400"></div>
        <div id="quiz-container" class="space-y-6">
            <p class="text-center text-lg font-medium">Loading...</p>
        </div>
        <button id="submit-btn"
            class="block w-full sm:w-auto mx-auto mt-8 px-8 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50">
            Submit Quiz
        </button>
    </div>

    <script>
        let testData = {};
        let userAnswers = {};
        let startTime;
        let timerInterval;
        let duration;

        function renderQuiz(test) {
            const quizContainer = document.getElementById('quiz-container');
            quizContainer.innerHTML = '';

            const title = document.createElement('h2');
            title.className = 'text-3xl font-bold mb-6 text-center text-indigo-900 dark:text-indigo-300';
            title.textContent = test.title;
            quizContainer.appendChild(title);

            test.questions.forEach((question, index) => {
                const questionCard = document.createElement('div');
                questionCard.className = 'bg-white dark:bg-gray-700 rounded-lg shadow-lg p-6 mb-6 transform transition duration-500 hover:scale-105';

                const questionText = document.createElement('p');
                questionText.className = 'text-xl font-semibold mb-4 text-gray-800 dark:text-gray-200';
                questionText.textContent = `Q${index + 1}: ${question.question}`;
                questionCard.appendChild(questionText);

                const optionsContainer = document.createElement('div');
                optionsContainer.className = 'space-y-2';

                question.options.forEach((option, i) => {
                    const optionDiv = document.createElement('div');
                    optionDiv.className = 'flex items-center p-3 rounded-md hover:bg-indigo-50 dark:hover:bg-gray-600 transition duration-300';

                    const input = document.createElement('input');
                    input.type = 'radio';
                    input.name = `q${index}`;
                    input.value = i;
                    input.id = `q${index}-${i}`;
                    input.className = 'form-radio h-5 w-5 text-indigo-600';

                    const label = document.createElement('label');
                    label.htmlFor = `q${index}-${i}`;
                    label.className = 'ml-3 text-gray-700 dark:text-gray-300 cursor-pointer flex-grow';
                    label.textContent = option.option_text;

                    optionDiv.appendChild(input);
                    optionDiv.appendChild(label);
                    optionsContainer.appendChild(optionDiv);
                });

                questionCard.appendChild(optionsContainer);
                quizContainer.appendChild(questionCard);

                optionsContainer.addEventListener('change', (event) => {
                    userAnswers[index] = parseInt(event.target.value);
                });
            });

            startTimer(test.duration);
        }

        function startTimer(durationInMinutes) {
            duration = durationInMinutes * 60;
            startTime = Date.now();
            updateTimer();
            timerInterval = setInterval(updateTimer, 1000);
        }

        function updateTimer() {
            const timerElement = document.getElementById('timer');
            const elapsedSeconds = Math.floor((Date.now() - startTime) / 1000);
            const remainingSeconds = Math.max(0, duration - elapsedSeconds);

            if (remainingSeconds === 0) {
                clearInterval(timerInterval);
                submitQuiz();
            } else {
                const minutes = Math.floor(remainingSeconds / 60);
                const seconds = remainingSeconds % 60;
                timerElement.textContent = `Time Remaining: ${minutes}:${seconds.toString().padStart(2, '0')}`;
            }
        }

        function getTestIdFromURL() {
            const pathParts = window.location.pathname.split('/');
            return pathParts[pathParts.length - 1];
        }

        async function fetchQuiz() {
            try {
                const testId = getTestIdFromURL();
                const response = await fetch(`/tests/${testId}`);
                if (!response.ok) throw new Error('Failed to fetch test');
                const test = await response.json();
                testData = test;
                renderQuiz(test);
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('quiz-container').innerHTML =
                    '<p class="text-red-500 dark:text-red-400 text-center">Failed to load quiz. Please try again later.</p>';
            }
        }

        function submitQuiz() {
            clearInterval(timerInterval);
            const endTime = Date.now();
            const totalTimeTaken = Math.floor((endTime - startTime) / 1000);

            const results = document.createElement('div');
            results.className = 'space-y-6';

            const summary = document.createElement('h3');
            summary.className = 'text-2xl font-bold mb-4 text-center text-indigo-900 dark:text-indigo-300';
            summary.textContent = 'Quiz Results';
            results.appendChild(summary);

            let score = 0;

            testData.questions.forEach((question, index) => {
                const userAnswer = userAnswers[index];
                const correctAnswer = question.correct_option;

                const resultCard = document.createElement('div');
                resultCard.className = 'bg-white dark:bg-gray-700 rounded-lg shadow-lg p-6';

                const isCorrect = userAnswer === correctAnswer;
                const resultClass = isCorrect ? 'text-green-600 dark:text-green-400' : 'text-red-600 dark:text-red-400';

                const userAnswerText = userAnswer !== undefined ? question.options[userAnswer].option_text : 'Not answered';
                const correctAnswerText = question.options[correctAnswer].option_text;

                const resultContent = `
                    <p class="font-semibold text-lg mb-2 text-gray-800 dark:text-gray-200">${question.question}</p>
                    <p class="mb-1">Your answer: <span class="${resultClass}">${userAnswerText}</span></p>
                    <p class="mb-2">Correct answer: <span class="text-green-600 dark:text-green-400">${correctAnswerText}</span></p>
                    <p class="${resultClass} font-medium">${isCorrect ? 'Correct!' : 'Incorrect'}</p>
                    ${question.explanation ? `<p class="mt-2 text-gray-600 dark:text-gray-400 italic">${question.explanation}</p>` : ''}
                `;

                resultCard.innerHTML = resultContent;
                results.appendChild(resultCard);

                if (isCorrect) score++;
            });

            const scoreSummary = document.createElement('div');
            scoreSummary.className = 'text-xl font-bold text-center mt-6 p-4 bg-indigo-100 dark:bg-zinc-700 rounded-lg border-2 border-indigo-300 dark:border-indigo-600';
            scoreSummary.innerHTML = `
                Your Score: ${score} / ${testData.questions.length}<br>
                Total Time Taken: ${Math.floor(totalTimeTaken / 60)}:${(totalTimeTaken % 60).toString().padStart(2, '0')}
            `;

            results.appendChild(scoreSummary);

            const backButton = document.createElement('button');
            backButton.textContent = 'Go Back to Mock Test Page';
            backButton.className = 'mt-4 px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-indigo-700 transition duration-200';
            backButton.onclick = () => {
                window.location.href = '/homepage';
            };

            results.appendChild(backButton);

            const quizContainer = document.getElementById('quiz-container');
            quizContainer.innerHTML = '';
            quizContainer.appendChild(results);

            document.getElementById('submit-btn').style.display = 'none';
            document.getElementById('timer').style.display = 'none';
        }

        document.getElementById('submit-btn').addEventListener('click', submitQuiz);

        // Dark mode toggle functionality
        const darkModeToggle = document.getElementById('dark-mode-toggle');
        const htmlElement = document.documentElement;

        darkModeToggle.addEventListener('click', () => {
            htmlElement.classList.toggle('dark');
        });

        fetchQuiz();
    </script>

</body>

</html>